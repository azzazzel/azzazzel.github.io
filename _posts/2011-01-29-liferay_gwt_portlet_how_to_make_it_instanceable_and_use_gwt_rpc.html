---
layout: post
title: Liferay GWT portlet - how to make it "instanceable" and use GWT RPC
date: '2011-01-29 15:46:35 +0100'
mt_id: 17
blog_id: 1
post_id: 17
basename: liferay_gwt_portlet_how_to_make_it_instanceable_and_use_gwt_rpc
categories:
- liferay
- tips_and_tricks
---
<p>Every once in a while somebody asks about writing <a href="http://liferay.com">Liferay</a> portlets in <a href="http://code.google.com/webtoolkit/">GWT</a>. It seems a lot of people are successfully using <a style="text-decoration: underline; outline-style: none; outline-width: initial; outline-color: initial; color: rgb(61, 123, 34); " href="http://code.google.com/webtoolkit/">GWT</a> with <a style="text-decoration: underline; outline-style: none; outline-width: initial; outline-color: initial; color: rgb(61, 123, 34); " href="http://liferay.com">Liferay</a> but surprisingly I couldn't find any complete tutorial on the subject. There are a of course tutorials explaining the basics but what they concentrate on, is how to build <i>single-instance</i> and <i>client-side-only</i> portlets. This is good enough to get you started but chances are sooner or later you'll need to place two instances of the same <a style="text-decoration: underline; outline-style: none; outline-width: initial; outline-color: initial; color: rgb(61, 123, 34); " href="http://code.google.com/webtoolkit/">GWT</a> portlet on the same page and/or implement <a href="http://code.google.com/intl/pl/webtoolkit/doc/latest/tutorial/RPC.html">GWT RPC</a> to make use of the <a style="text-decoration: underline; outline-style: none; outline-width: initial; outline-color: initial; color: rgb(61, 123, 34); " href="http://liferay.com">Liferay</a>&nbsp;services.</p> <p>I've reached that point myself sometime ago and unfortunately had to solve the problem myself. Then I wrote sample portlet called <a href="https://github.com/azzazzel/gwt-chatrooms-portlet">gwt-chatrooms-portlet</a> to demonstrate the solution and hopefully save you some time. So here is a step by step tutorial how to create GWT portlet for <a href="http://www.liferay.com/downloads/liferay-portal/available-releases">Liferay 6.0.5</a> which:</p> <ul>     <li>allows many instances to be placed on the same page</li>     <li>uses <a style="text-decoration: underline; outline-style: none; outline-width: initial; outline-color: initial; color: rgb(61, 123, 34); " href="http://code.google.com/intl/pl/webtoolkit/doc/latest/tutorial/RPC.html">GWT RPC</a> for client-server communication</li> </ul>

<!--more-->

<p>The gwt-chatrooms-portlet is very simple portlet allowing users to enter chat room <i>(by typing in it's name)</i> and then chat with other users. Here is screenshot :</p> <p><img alt="screenshot of chatrooms GWT portlet" width="710" src="/assets/2011-01-29-liferay_gwt_portlet_how_to_make_it_instanceable_and_use_gwt_rpc/chatrooms-gwt-portlet.png" /> <br /> As you can see, multiple instances can be added on the same page allowing users to chat in more than one room at a time. Message persistence API is generated using Liferay's <a href="http://www.liferay.com/documentation/liferay-portal/6.0/development/-/ai/service-builder">ServiceBuilder</a>. The <a style="text-decoration: underline; outline-style: none; outline-width: initial; outline-color: initial; color: rgb(61, 123, 34); " href="http://code.google.com/webtoolkit/">GWT</a>&nbsp;client code uses <a style="text-decoration: underline; outline-style: none; outline-width: initial; outline-color: initial; color: rgb(61, 123, 34); " href="http://code.google.com/intl/pl/webtoolkit/doc/latest/tutorial/RPC.html">GWT RPC</a>&nbsp;to receive room messages from the server and store new ones. Here is how to build it.</p> <p>&nbsp;</p> <h2><span style="font-size: large; "><u><b>Generate the portlet in Liferay SDK</b></u></span><u> </u></h2> <p>OK first things first. Make sure you have <a style="text-decoration: underline; outline-style: none; outline-width: initial; outline-color: initial; color: rgb(61, 123, 34); " href="http://www.liferay.com/downloads/liferay-portal/available-releases">Liferay 6.0.5</a>&nbsp;and <a href="http://www.liferay.com/downloads/liferay-portal/additional-files">Liferay plugins SDK-6.0.5</a> installed and configured. Then create new portlet by tying :<br /> <code class="block">create.sh gwt-chatrooms &quot;Chatrooms - Sample GWT portlet&quot; </code>  <br /> in <b><span style="font-family: 'Courier New'; ">&lt;LIFERAY_SDK_HOME&gt;/portlets</span></b>. This will create <b><span style="font-family: 'Courier New'; ">gwt-chatrooms-portlet</span></b>&nbsp;folder and the standard set of files.&nbsp;<a href="https://github.com/azzazzel/gwt-chatrooms-portlet/commit/7c65913dca9d18df440831c39fb76b897570834a">This is in my first commit</a>.</p> <p>&nbsp;</p> <h2 style="margin-top: 0px; margin-right: 0px; margin-bottom: 0.75em; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; font-size: 13px; font-weight: normal; "><span style="font-size: large; "><u><b>Add GWT compile task to the build</b></u></span></h2> <p>Before you continue with actual development, you have to add an ant task to <b><span style="font-family: 'Courier New'; ">&lt;LIFERAY_SDK_HOME&gt;/portlets/gwt-chatrooms-portlet/build.xml</span></b> responsible for compiling GWT code.   The code is available <a href="https://github.com/azzazzel/gwt-chatrooms-portlet/blob/57c4c010c7aad160bb84e4ecbae02df94119c29e/build.xml">here</a>. You have probably noticed my task uses <b><span style="font-family: 'Courier New'; ">${gwt.sdk}</span></b> variable. To use it as is you have to set it's value in  <b><span style="font-family: 'Courier New'; ">&lt;LIFERAY_SDK_HOME&gt;/build.&lt;USER_NAME&gt;.properties</span></b>&nbsp;file :<br /> <code class="blockWhite">gwt.sdk=&lt;GWT_HOME&gt;</code></p> <p>&nbsp;&nbsp;</p> <h2 style="margin-top: 0px; margin-right: 0px; margin-bottom: 0.75em; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; font-size: 13px; font-weight: normal; "><span style="font-size: large; "><u><b>Create GWT module and entry point class</b></u></span></h2> <p>Now you are ready for GWT portlet development. Create GWT module file <b><span style="font-family: 'Courier New'; ">gwt-chatrooms-portlet/docroot/WEB-INF/src/com/commsen/sample/portlet/chatrooms/Chatrooms.gwt.xml&nbsp;</span></b></p> <pre style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; font: normal normal normal 12px/normal Monaco, 'Courier New', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', monospace; font-family: 'Bitstream Vera Sans Mono', Courier, monospace; font-size: 12px; "><code class="blockWhite"><span class="nt" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; color: rgb(0, 0, 128); ">&lt;module</span> <span class="na" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; color: rgb(0, 128, 128); ">rename-to=</span><span class="s" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; color: rgb(221, 17, 68); ">'Chatrooms'</span><span class="nt" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; color: rgb(0, 0, 128); ">&gt;<br /></span>&nbsp;&nbsp;<span class="nt" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; color: rgb(0, 0, 128); ">&lt;inherits</span> <span class="na" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; color: rgb(0, 128, 128); ">name=</span><span class="s" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; color: rgb(221, 17, 68); ">'com.google.gwt.user.User'</span><span class="nt" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; color: rgb(0, 0, 128); ">/&gt;<br /></span>&nbsp;&nbsp;<span class="nt" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; color: rgb(0, 0, 128); ">&lt;inherits</span> <span class="na" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; color: rgb(0, 128, 128); ">name=</span><span class="s" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; color: rgb(221, 17, 68); ">'com.google.gwt.user.theme.standard.Standard'</span><span class="nt" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; color: rgb(0, 0, 128); ">/&gt;<br /></span>&nbsp;&nbsp;<span class="nt" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; color: rgb(0, 0, 128); ">&lt;entry-point</span> <span class="na" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; color: rgb(0, 128, 128); ">class=</span><span class="s" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; color: rgb(221, 17, 68); ">'com.commsen.sample.portlet.chatrooms.client.GWTEntryPoint'</span><span class="nt" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; color: rgb(0, 0, 128); ">/&gt;<br /></span>&nbsp;&nbsp;<span class="nt" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; color: rgb(0, 0, 128); ">&lt;source</span> <span class="na" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; color: rgb(0, 128, 128); ">path=</span><span class="s" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; color: rgb(221, 17, 68); ">'client'</span><span class="nt" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; color: rgb(0, 0, 128); ">/&gt;<br /></span>&nbsp;&nbsp;<span class="nt" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; color: rgb(0, 0, 128); ">&lt;source</span> <span class="na" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; color: rgb(0, 128, 128); ">path=</span><span class="s" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; color: rgb(221, 17, 68); ">'shared'</span><span class="nt" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; color: rgb(0, 0, 128); ">/&gt;<br /></span><span class="Apple-style-span" style="line-height: 14px; color: rgb(0, 0, 128); ">&lt;/module&gt;</span></code></pre> <p>and GWT entry point  class <b><span style="font-family: 'Courier New'; ">&lt;LIFERAY_SDK_HOME&gt;/portlets/gwt-chatrooms-portlet/docroot/WEB-INF/src/com/commsen/sample/portlet/chatrooms/client/GWTEntryPoint.java</span></b></p> <p>&nbsp;</p> <pre style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; font: normal normal normal 12px/normal Monaco, 'Courier New', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', monospace; font-family: 'Bitstream Vera Sans Mono', Courier, monospace; font-size: 12px; "><code class="blockWhite"><span style="font-family: 'Courier New'; "><span class="kd" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; font-weight: bold; ">public</span> <span class="kd" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; font-weight: bold; ">class</span> <span class="nc" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; color: rgb(68, 85, 136); font-weight: bold; ">GWTEntryPoint</span> <span class="kd" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; font-weight: bold; ">implements</span> <span class="n" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; ">EntryPoint</span> <span class="o" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; font-weight: bold; ">{<br /></span><span class="Apple-style-span" style="line-height: 14px; ">   @Override<br /></span><span class="kd" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; font-weight: bold; ">   public</span> <span class="kt" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; color: rgb(68, 85, 136); font-weight: bold; ">void</span> <span class="nf" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; color: rgb(153, 0, 0); font-weight: bold; ">onModuleLoad</span><span class="o" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; font-weight: bold; ">()</span> <span class="o" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; font-weight: bold; ">{<br /></span><span class="n" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; ">      RootPanel</span><span class="o" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; font-weight: bold; ">.</span><span class="na" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; color: rgb(0, 128, 128); ">get</span><span class="o" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; font-weight: bold; ">(</span><span class="s" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; color: rgb(221, 17, 68); ">&quot;chatrooms-portlet&quot;</span><span class="o" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; font-weight: bold; ">).</span><span class="na" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; color: rgb(0, 128, 128); ">add</span><span class="o" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; font-weight: bold; ">(</span><span class="k" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; font-weight: bold; ">new</span> <span class="n" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; ">HTML</span><span class="o" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; font-weight: bold; ">(</span><span class="s" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; color: rgb(221, 17, 68); ">&quot;This is the &lt;b&gt;GWT chat rooms&lt;/b&gt; portlet.&quot;</span><span class="o" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; font-weight: bold; ">));<br /></span><span class="o" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; font-weight: bold; ">   }<br /></span><span class="Apple-style-span" style="line-height: 14px; font-weight: bold; ">}</span></span></code></pre> <p>In <span style="font-family: 'Courier New'; "><b>view.jsp</b></span>  remove the default message and add <b><span style="font-family: 'Courier New'; ">div</span></b> element with id &quot;<span style="color: rgb(51, 51, 0); "><b>chatrooms-portlet</b></span>&quot; - this is the container for GWT code. Next replace default value of &quot;<span style="color: rgb(51, 51, 0); "><b>footer-portlet-javascript</b></span>&quot; in <b><span style="font-family: 'Courier New'; ">&lt;LIFERAY_SDK_HOME&gt;/portlets/gwt-chatrooms-portletdocroot/WEB-INF/liferay-portlet.xml</span></b> with &quot;<span style="color: rgb(51, 51, 0); "><b>/Chatrooms/Chatrooms.nocache.js</b></span>&quot; <i>(assuming &quot;<b><span style="color: rgb(51, 51, 0); ">Chatrooms</span></b>&quot; is the name of your GWT module)</i>. <a href="https://github.com/azzazzel/gwt-chatrooms-portlet/commit/9623586fc32433a11bdadf6298d40e66b680c661">Here are my changes</a>.</p> <p>Before you deploy and see your portlet in action you need to also add</p> <p><code class="blockWhite">&lt;ajaxable&gt;false&lt;/ajaxable&gt;&nbsp;</code></p> <p>into portlet's configuration in&nbsp;<span style="font-family: 'Courier New'; "><b>liferay-portlet.xml</b></span> file to make sure Liferay will not use AJAX to load portlet's content . However if you try to place 2 instance of the portlet on the same page you'll be surprised that one of them (or even both in some browsers) shows up empty. This is because the HTML page now has more than one <span style="font-family: 'Courier New'; "><b>div</b></span> element with the same id&nbsp;&quot;<span style="color: rgb(51, 51, 0); "><b>chatrooms-portlet</b></span>&quot;.</p> <p>&nbsp;&nbsp;&nbsp;</p> <h2 style="margin-top: 0px; margin-right: 0px; margin-bottom: 0.75em; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; font-size: 13px; font-weight: normal; "><span style="font-size: large; "><u><b>Make GWT code recognize portlet instances</b></u></span></h2> <p>To overcome the problem you can make use of portlet's instance id and add it to the id of the <span style="font-family: 'Courier New'; "><b>div</b></span> element in every portlet. To prepare for this change, create a javascript array (say <span style="font-family: 'Courier New'; "><b>chatroomPortletInstances</b></span>) to hold portlet instance ids. <a href="https://github.com/azzazzel/gwt-chatrooms-portlet/commit/6cd49209efb204be0876fa4713daeb5e3b9575c7">Here is how I did it</a>. Then modify <span style="font-family: 'Courier New'; "><b>view.jsp</b></span> &nbsp;so that it adds the portlet id into&nbsp; <span class="Apple-style-span" style="font-family: 'Courier New'; "><b>chatroomPortletInstances</b></span>&nbsp;and make the <b><span style="font-family: 'Courier New'; ">div</span></b> id contain the portlet id. See <a href="https://github.com/azzazzel/gwt-chatrooms-portlet/commit/bf7e759dbe5c6ca6f83ee2ad437af56fef5def21">my code</a> for example.</p> <p>Now you need to let the GWT code &quot;know&quot; about portlet instances. So instead of doing all initialization in the entry point class <i>(which I consider bad practice anyway)</i> create a dedicated class (say <b><span style="font-family: 'Courier New'; ">Chatroom</span></b>) with constructor accepting portlet id as parameter. This way you can create dedicated&nbsp;<b><span style="font-family: 'Courier New'; ">Chatroom</span></b>&nbsp;instance for every portlet instance. In order to do that you need to know the ids of all portlet instances available on the page and this is where <span class="Apple-style-span" style="font-family: 'Courier New'; "><b>chatroomPortletInstances</b></span>&nbsp;array comes in. Thanks to GWT's <a href="http://code.google.com/intl/pl/webtoolkit/doc/latest/DevGuideCodingBasicsJSNI.html">JSNI</a> is as easy as</p> <p><code class="blockWhite">&nbsp;<span class="Apple-style-span" style="color: rgb(0, 0, 0); font-family: 'Bitstream Vera Sans Mono', Courier, monospace; font-size: 12px; line-height: 16px; white-space: pre; ">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; font-weight: bold; ">public</span> <span class="kd" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; font-weight: bold; ">static</span> <span class="kd" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; font-weight: bold; ">native</span> <span class="n" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; ">JsArrayString</span> <span class="nf" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; color: rgb(153, 0, 0); font-weight: bold; ">getPortletInstances</span><span class="o" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; font-weight: bold; ">()<br /> </span></span><span class="Apple-style-span" style="font-family: 'Bitstream Vera Sans Mono', Courier, monospace; font-size: 12px; line-height: 16px; white-space: pre; ">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(0, 0, 0); "><span class="cm" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; font-style: italic; ">/*-{<br /> </span></span></span><span class="Apple-style-span" style="font-style: italic; line-height: 14px; white-space: pre; ">        return $wnd.chatroomPortletInstances;<br /> </span><span class="Apple-style-span" style="line-height: 16px; white-space: pre; "><span style="color: rgb(0, 0, 0); "><span class="cm" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; font-style: italic; ">    }-*/</span></span><span class="o" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 1.4em; font-weight: bold; ">;</span></span>&nbsp;</code></p> <p>&nbsp;Now all that's left is to iterate over portlet instances and create&nbsp;<b><span style="font-family: 'Courier New'; ">Chatroom&nbsp;</span></b>instance for each. Of course feel free to use&nbsp;<a href="https://github.com/azzazzel/gwt-chatrooms-portlet/commit/4bc17ce9e8f9e23af5f49f7e9561be17e73f2efc">my code</a>&nbsp;as example.&nbsp;</p> <p><span style="color: rgb(51, 51, 0); "><b>Now you can place as many GWT portlet instances as you wish&nbsp;</b></span><span class="Apple-style-span" style="color: rgb(51, 51, 0); "><b>on the same portal page</b></span><span class="Apple-style-span" style="color: rgb(51, 51, 0); "><b>!</b></span></p> <p>If you want to test it, go to portlet's folder ant type&nbsp;</p> <p><code class="block">ant clean gwtc deploy</code></p> <p>&nbsp;</p> <h2 style="margin-top: 0px; margin-right: 0px; margin-bottom: 0.75em; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; font-size: 13px; font-weight: normal; "><span style="font-size: large; "><u><b>Generate Liferay services with ServiceBuilder</b></u></span></h2> <p>The portlet needs to persist the chatrooms' messages in Liferay's database. Thus you need to have at least some services and persitence API on the server side. Fortunately with Liferay's <a style="text-decoration: underline; outline-style: none; outline-width: initial; outline-color: initial; color: rgb(61, 123, 34); " href="http://www.liferay.com/documentation/liferay-portal/6.0/development/-/ai/service-builder">ServiceBuilder</a>&nbsp;almost everything can be generated by providing a single XML file. <a href="https://github.com/azzazzel/gwt-chatrooms-portlet/blob/63b77b5960a1f68e05f1bc602c3a9573a92aa3d7/docroot/WEB-INF/service.xml">Here is the one I used</a>. I'm not going to explain in details how <a style="text-decoration: underline; outline-style: none; outline-width: initial; outline-color: initial; color: rgb(61, 123, 34); " href="http://www.liferay.com/documentation/liferay-portal/6.0/development/-/ai/service-builder">ServiceBuilder</a>&nbsp;works<i> (please see Liferay's documentation)</i>. In case you are not really trying to learn but simply follow the instructions, here is the one-liner: Place the XML file in <b><span style="font-family: 'Courier New'; ">WEB-INF </span></b>folder and then do<code class="block">ant build-service</code>it will generate everything you need.</p> <p>The most important things to notice are the&nbsp;<b><span style="font-family: 'Courier New'; ">Message</span></b>&nbsp;interface (represents chatroom message) and the&nbsp;<b><span style="font-family: 'Courier New'; ">MessageLocalServiceUtil</span></b> class which provides convenient static methods for creating, storing and retrieving&nbsp; <b><span style="font-family: 'Courier New'; ">Message&nbsp;</span></b>objects. By the way&nbsp;<a href="https://github.com/azzazzel/gwt-chatrooms-portlet/commit/63b77b5960a1f68e05f1bc602c3a9573a92aa3d7">this commit</a> contains all the files generated by&nbsp;<a style="text-decoration: underline; outline-style: none; outline-width: initial; outline-color: initial; color: rgb(61, 123, 34); " href="http://www.liferay.com/documentation/liferay-portal/6.0/development/-/ai/service-builder">ServiceBuilder</a>&nbsp;in case you are curious.</p> <p>&nbsp;</p> <h2 style="margin-top: 0px; margin-right: 0px; margin-bottom: 0.75em; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; "><span style="font-size: large; "><font class="Apple-style-span"><b><u>Implement the view and&nbsp;</u></b></font><span class="Apple-style-span"><b><u>GWT&nbsp;</u></b></span><span class="Apple-style-span"><b><u>RPC</u></b></span></span></h2> <p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0.75em; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; ">Finally it is time to get your hands dirty with some real GWT stuff. &nbsp;First you need to create standard <a style="text-decoration: underline; outline-style: none; outline-width: initial; outline-color: initial; color: rgb(61, 123, 34); " href="http://code.google.com/intl/pl/webtoolkit/doc/latest/tutorial/RPC.html">GWT RPC</a>&nbsp;service to save and receive messages. So create the&nbsp;<span style="font-family: 'Courier New'; "><b>ChatroomService</b></span> and&nbsp;<span style="font-family: 'Courier New'; "><b>ChatroomServiceAsync</b></span> interfaces in client code and&nbsp;<span style="font-family: 'Courier New'; "><b>ChatroomServiceImpl</b></span> in server side code. They need to have 2 methods <span style="font-family: 'Courier New'; "><b>saveMessage</b></span> and <span style="font-family: 'Courier New'; "><b>getMessages</b></span>. &nbsp;</p> <p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0.75em; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; ">In the implementation code of those methods in&nbsp;<span class="Apple-style-span" style="font-family: 'Courier New'; "><b>ChatroomServiceImpl </b></span>you can call appropriate methods form&nbsp;<b><span style="font-family: 'Courier New'; ">MessageLocalServiceUtil&nbsp;</span></b>or use Liferay's utility class&nbsp;<b><span style="font-family: 'Courier New'; ">PortalUtil</span></b>&nbsp;to get access to other Liferay services <i>(for example to get the current user).</i> <a href="https://github.com/azzazzel/gwt-chatrooms-portlet/blob/9a084048e203bbf3c6642c522ceb60c51e8a480b/docroot/WEB-INF/src/com/commsen/sample/portlet/chatrooms/server/ChatroomServiceImpl.java">Here is what I did</a>.</p> <p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0.75em; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; ">Then you need to code the view. It's really up to you how you design the front end but&nbsp;of course I'll use&nbsp;<a href="https://github.com/azzazzel/gwt-chatrooms-portlet/blob/9a084048e203bbf3c6642c522ceb60c51e8a480b/docroot/WEB-INF/src/com/commsen/sample/portlet/chatrooms/client/Chatroom.java">my version of&nbsp;<b><span style="font-family: 'Courier New'; ">Chatroom </span></b>class</a>&nbsp;to point out the key elements<i>:&nbsp;</i>&nbsp;</p> <ul>     <li><b><span style="font-family: 'Courier New'; ">sendMessageToServer</span></b> method uses <span style="font-family: 'Courier New'; "><b>ChatroomService</b></span> to send user's message&nbsp;</li>     <li><b><span style="font-family: 'Courier New'; ">getMessages</span></b> method is continuously called by GWT timer to refresh the chatroom view</li>     <li>somewhat mysterious code at line 52</li> </ul> <p>By now you may think that you are ready. Simply configure&nbsp;<span class="Apple-style-span" style="font-family: 'Courier New'; "><b>ChatroomServiceImpl</b></span>&nbsp;servlet in <span style="font-family: 'Courier New'; "><b>web.xml</b></span>, compile, deploy and enjoy. In fact if you do so, there will be unpleasant surprise. &nbsp;The problem with this standard GWT approach is that you will be calling the&nbsp;<span class="Apple-style-span" style="font-family: 'Courier New'; "><b>ChatroomServiceImpl</b></span>&nbsp;servlet directly and not through the portal. This means the portal will never have a chance to do it's magic. This means non of it's service classes will be available for the servlet. This means you'll see a nice&nbsp;<span class="Apple-style-span" style="color: rgb(0, 0, 0); font-family: monospace; font-size: medium; white-space: pre; "><b>NoClassDefFoundError</b></span>&nbsp;in your server's logs.</p> <p>Luckily since version&nbsp;<span class="Apple-style-span" style="font-family: Verdana, sans-serif; line-height: 19px; ">4.3.x&nbsp;</span>Liferay has built in solution for this problem. It's called&nbsp;<a href="http://longgoldenears.blogspot.com/2008/03/portaldelegateservlet-servlet-session.html">PortalDelegateServlet</a>. I'm&nbsp;oversimplifying the concept here but basically it allows you to define a servlet in portal's context. There is special delegate servlet, mapped at <b><span style="font-family: 'Courier New'; ">/delegate</span></b>&nbsp;location. Liferay extensions can configure sub-contexts to redirect to their own servlets after the portal is done with the magic. Having this in mind there are 2 more things you need to do:</p> <ul>     <li>configure your portlet to use <span style="font-family: 'Courier New'; "><b>PortalDelegateServlet</b></span></li>     <li>change the address of your servlet in GWT's front-end code</li> </ul> <p>For the first one have a look at <a href="https://github.com/azzazzel/gwt-chatrooms-portlet/blob/9a084048e203bbf3c6642c522ceb60c51e8a480b/docroot/WEB-INF/web.xml">how I have done it</a> &nbsp;and for the second one ... well that is the &quot;<i>somewhat mysterious code at line 52</i>&quot; mentioned above.&nbsp;Of course complete list of changes described in this section is in my&nbsp;<a href="https://github.com/azzazzel/gwt-chatrooms-portlet/commit/9a084048e203bbf3c6642c522ceb60c51e8a480b">final commit</a>. &nbsp; &nbsp;&nbsp;</p> <p>And this is it. Compile, deploy, enjoy!&nbsp;</p>
